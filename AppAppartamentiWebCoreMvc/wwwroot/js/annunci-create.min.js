function ComponiFasceOrarie(input){var superParent=$(input).parent().parent(),idValoreFasceGiornaliere=$(superParent).data("for"),fasce=null;$(superParent).children(".input-time-slot").length>0&&(fasce="",$(superParent).children(".input-time-slot").each(function(){fasce+=$(this).children('input[name="fasciaOrariaFrom"]').val();fasce+="-";fasce+=$(this).children('input[name="fasciaOrariaTo"]').val();fasce+=";"}));$(idValoreFasceGiornaliere).val(fasce)}function RemoveSlot(button){$(button).parent().remove()}function ToggleSlot(button){var target=$(button).data("target");$(target).css("display")=="none"?$(target).show():$(target).hide()}function CreateNewTimeSlot(timeslotButton){var target=$(timeslotButton).data("target"),currentIndex=$(target).data("index"),newElement=$(target).clone(),newFrom,newTo;newElement.removeAttr("id");newElement.children(".btn-remove-slot").show();newElement.removeAttr("data-index");newFrom=newElement.children('input[name="fasciaOrariaFrom"]');newFrom.change(function(){ComponiFasceOrarie(this)});newFrom.val(null);newTo=newElement.children('input[name="fasciaOrariaTo"]');newTo.change(function(){ComponiFasceOrarie(this)});newTo.val(null);newElement.appendTo($(timeslotButton).parent())}function changeScroll(){document.body.scrollTop>70||document.documentElement.scrollTop>70?($("#smallTitle").show(),$("#navbar-create").removeClass("mt-5")):($("#smallTitle").hide(),$("#navbar-create").addClass("mt-5"))}async function GetImmagini(input,listname,inputname){const file=input.files[0];let toBase64=new Promise((resolve,reject)=>{const reader=new FileReader;reader.readAsDataURL(file);reader.onload=()=>resolve(reader.result);reader.onerror=error=>reject(error)}),base64=await toBase64,imageBytes=base64.slice(base64.indexOf(",")).substring(1,base64.lenght);document.getElementById(listname).innerHTML+='<div class="col-xs-12 col-sm-4 p-0 ad-create-image"><button onclick="RemoveFile(this)" class="btn-remove btn btn-light rounded-circle position-fixed border"><i class="fas fa-trash-alt"><\/i><\/button><input style="display:none" name="'+inputname+"["+numImage+']" value="'+imageBytes+'"/><div class="border p-2 m-2"><img id="ad-image" src="'+base64+'" alt="image" class="d-block w-100 " /><\/div><\/div>';numImage+=1}async function GetPlanimetrie(input,listname,inputname){const file=input.files[0];let toBase64=new Promise((resolve,reject)=>{const reader=new FileReader;reader.readAsDataURL(file);reader.onload=()=>resolve(reader.result);reader.onerror=error=>reject(error)}),base64=await toBase64,imageBytes=base64.slice(base64.indexOf(",")).substring(1,base64.lenght);document.getElementById(listname).innerHTML+='<div class="col-xs-12 col-sm-4 p-0 ad-create-image"><button onclick="RemoveFile(this)" class="btn-remove btn btn-light rounded-circle position-fixed border"><i class="fas fa-trash-alt"><\/i><\/button><input style="display:none" name="'+inputname+"["+numPlanimetria+']" value="'+imageBytes+'"/><div class="border p-2 m-2"><img id="ad-image" src="'+base64+'" alt="image" class="d-block w-100 " /><\/div><\/div>';numPlanimetria+=1}function setMap(){var comune=$("#input-comune").val(),indirizzo=$("#Indirizzo").val(),address,geocoder;comune!=null&&comune.length>0&&indirizzo!=null&&indirizzo.length>0&&(address=indirizzo+","+comune,geocoder=new google.maps.Geocoder,geocoder.geocode({address:address},function(results,status){if(status=="OK"){var map=new google.maps.Map(document.getElementById("googleMap"),{zoom:10,mapTypeControl:!1,streetViewControl:!1}),marker=new google.maps.Marker({map:map,position:results[0].geometry.location});map.setCenter(results[0].geometry.location);$("#CoordinateGeografiche").val(results[0].geometry.location.lat()+";"+results[0].geometry.location.lng());$("#googleMap").show()}else alert("Geocode was not successful for the following reason: "+status)}))}function EnableCitySearch(searchTextbox){try{let nomeComune=$(searchTextbox).val();listaComuni.length>0&&nomeComune.length<3?(listaComuni=[],$(searchTextbox).autocomplete({source:[]})):listaComuni.length==0&&nomeComune.length>=3&&($("#city-spinner").show(),$.ajax({type:"POST",url:"/Home/ListaComuni",data:{NomeComune:nomeComune},dataType:"json",cache:!1,success:function(result){var nomiComuni,i;for(comuni=result,nomiComuni=[],i=0;i<result.length;i++)nomiComuni.push(result[i].NomeComune);$(searchTextbox).autocomplete({source:nomiComuni,select:function(event,ui){var value,i;for($("#Indirizzo").removeAttr("disabled"),value=ui.item.value,i=0;i<comuni.length;i++)if(comuni[i].NomeComune==value){$("#CodiceComune").val(comuni[i].CodiceComune);break}}});$("#city-spinner").hide();$(searchTextbox).autocomplete("search")},error:function(){TrapError("Error during EnableSearch")}}))}catch(ex){TrapError("Error during EnableSearch")}}function RemoveFile(button){$(button).parent().remove()}var numImage=0,numPlanimetria=0,numFasceLun=0,comuni;$(document).ready(function(){$("#smallTitle").hide();$("#navbar-create").addClass("mt-5");window.onscroll=function(){changeScroll()};$("#input-planimetria").change(function(){GetPlanimetrie(this,$(this).data("list-name"),$(this).data("input-name"))});$("#input-immagini").change(function(){GetImmagini(this,$(this).data("list-name"),$(this).data("input-name"))});$("#Indirizzo").blur(function(){setMap()});$("#input-comune").keyup(function(){EnableCitySearch(this)});$(".btn-time-slot").click(function(){CreateNewTimeSlot(this)});$(".btn-toggle-slot").click(function(){ToggleSlot(this)});$(".btn-remove-slot").click(function(){RemoveSlot(this)});$("#btn-virtual-agent").dropdown("toggle");$("#create-pills-tab .nav-link").click(function(){$("#form-create").valid()?$("#create-pills-tab .active").removeClass("nav-error-link"):$("#create-pills-tab .active").addClass("nav-error-link")});$('input[name="fasciaOrariaFrom"]').change(function(){ComponiFasceOrarie(this)});$('input[name="fasciaOrariaTo"]').change(function(){ComponiFasceOrarie(this)})});comuni=[];