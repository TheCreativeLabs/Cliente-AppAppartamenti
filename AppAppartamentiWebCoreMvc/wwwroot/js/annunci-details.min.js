function LoadCalendar(IdAnnuncio){let calendar=document.getElementById("appointment-caledar"),today=new Date,currentMonth=today.getMonth(),currentYear=today.getFullYear();$.ajax({type:"POST",url:"/Agenda/GetEnabledDate",data:{IdAnnuncio:IdAnnuncio,CurrentMonth:currentMonth,CurrentYear:currentYear},dataType:"json",cache:!1,success:function(result){let listDate=GetEnabledDate(result,currentYear,currentMonth);var calendar2=new FullCalendar.Calendar(calendar,{plugins:["dayGrid","timeGrid","interaction"],locale:selectedLanguage,themeSystem:"bootstrap",header:{left:"title",center:"",right:"prev,next"},footer:{left:"",center:"",right:""},dateClick:function(info){var now=new Date;(now.getFullYear()+"-"+(now.getMonth()+1)+"-"+now.getDate()==info.dateStr||info.date>now)&&($("#giorno-selected").val(info.dateStr),$(".fc-today").css("blackground","transparent !important"),GetAndShowAppuntamentiDisponibili(IdAnnuncio,info.dateStr))},selectable:!0,events:listDate,showNonCurrentDates:!1});calendar2.render();$("#appointmentModal").on("shown.bs.modal",function(){calendar2.render();$(".fc-next-button").click(function(){let date=calendar2.getDate(),month=date.getMonth(),year=date.getFullYear();$.ajax({type:"POST",url:"/Agenda/GetEnabledDate",data:{IdAnnuncio:IdAnnuncio,CurrentMonth:month,CurrentYear:year},dataType:"json",cache:!1,success:function(result){let listDate=GetEnabledDate(result,year,month);calendar2.addEventSource(listDate)},error:function(){console.log("error")}})})})},error:function(){console.log("error")}})}function GetEnabledDate(enabledDates,year,month){var listDate,i,numDay,d;let enabledDate=[];for(listDate=[],i=0;i<enabledDates.length;i++)enabledDate.push(new Date(enabledDates[i]).valueOf());let numberOfDay=new Date(year,month+1,0).getDate();for(numDay=1;numDay<numberOfDay+1;numDay++){d=new Date(year,month,numDay,0,1,0);let dyear=d.getFullYear(),dmonth=d.getMonth()+1;dmonth<10&&(dmonth="0"+dmonth);let dday=d.getDate();dday<10&&(dday="0"+dday);let isIncluded=enabledDate.includes(d.valueOf());if(isIncluded==!1){let tets={start:d.getFullYear()+"-"+dmonth+"-"+dday,rendering:"background"};listDate.push(tets)}}return listDate}function LoadReportModal(){$("#report-modal").load("/Annunci/SignalAdReason",function(){})}function changeScroll(){document.body.scrollTop>100||document.documentElement.scrollTop>100?($("#secondnav").addClass("d-sm-block "),$("#nav").removeClass("shadow-sm")):($("#secondnav").removeClass("d-sm-block "),$("#nav").addClass("shadow-sm"))}function setMap(){var coordinates=$("#googleMap").data("latlng"),splittedCoordinates=coordinates.split(";"),lat=splittedCoordinates[0],lng=splittedCoordinates[1],LatLng={lat:parseFloat(lat),lng:parseFloat(lng)},map=new google.maps.Map(document.getElementById("googleMap"),{zoom:10,mapTypeControl:!1,streetViewControl:!1}),marker;map.setCenter(LatLng);marker=new google.maps.Marker({position:LatLng,map:map})}function ToggleTimeSlot(btn){var cliccato=$(btn);$(".btn-orario-appuntamento").each(function(){$(this)!=cliccato&&$(this).removeClass("active")})}function GetAndShowAppuntamentiDisponibili(idAnnuncio,giorno){$("#detail-agenda-spinner-loading").show();$("#appointment-available").empty();let url="/Agenda/AppuntamentiDisponibili?IdAnnuncio="+idAnnuncio+"&Giorno="+giorno;$("#appointment-available").load(url,function(){$("#detail-agenda-spinner-loading").hide();$(".btn-prenota-appuntamento").show()})}function PrenotaAppuntamento(){var ora=$(".btn-orario-appuntamento.active").text(),idAnnuncio=document.getElementById("id-annuncio").value,giorno=$("#giorno-selected").val(),ora=ora.split("-")[0];$.ajax({type:"GET",url:"/AnnunciPersonali/PrenotaAppuntamento",data:{IdAnnuncio:idAnnuncio,Giorno:giorno,Ora:ora},dataType:"json",contentType:"application/json; charset=utf-8",success:function(){alert("appuntamento done")},error:function(){$("#appointmentModal").modal("hide")}})}function GetImmaginiAnnuncioAjax(idAnnuncio){return $.ajax({type:"GET",url:"/Annunci/ImmaginiAnnuncio",data:{IdAnnuncio:idAnnuncio},dataType:"json",contentType:"application/json; charset=utf-8",success:function(result){var isActiveInserted=!1,innerHTML="",innerOlHTML="";for(var k in result)isActiveInserted?(innerHTML+='<div class="carousel-item" style="max-height: 500px"><img src="'+result[k]+'" class="d-block w-100" alt="image" /><\/div>',innerOlHTML+='<li data-target="#carouselExampleIndicators" data-slide-to="'+k+'"><\/li>'):(innerHTML+='<div class="carousel-item active" style="height: 500px"><img src="'+result[k]+'" class="w-100 h-100" alt="image" /><\/div>',innerOlHTML+='<li data-target="#carouselExampleIndicators" data-slide-to="'+k+'" class="active"><\/li>',isActiveInserted=!0);$(".carousel-inner").html(innerHTML);$(".carousel-indicators").html(innerOlHTML)},error:function(){}})}function OpenModal(IdAnnuncio,IdPersonToChat,PersonToChat){let url="/Messaggi/GetChatDetail?IdChat=&IdAnnuncio="+IdAnnuncio+"&IdPersonToChat="+IdPersonToChat;$("#chat-spinner-loading").show();$("#messages-list").empty();$("#chat-modal-title").text(PersonToChat);$("#chat-modal").modal("show");ReloadChatContentModal(url,!0);reloadInterval=setInterval(function(){ReloadChatContentModal(url,!1)},4e4)}function ReloadChatContentModal(UrlToLoad,FirstTime){$("#messages-list").load(UrlToLoad,function(){$("#chat-spinner-loading").hide();(FirstTime==!0||$("#chat-modal-body").scrollTop()==$("#chat-modal-body").height())&&$("#chat-modal-body").scrollTop($("#chat-modal-body")[0].scrollHeight)})}function SendMessage(){let idChat=$("#chat-modal .row").data("idchat"),idPerson=$("#chat-modal .row").data("idperson"),message=$("#chat-textarea").val(),content='<div class="offset-2 mt-2 mb-2 col-10 bg-primary rounded p-2">';content+='<span style="color:white">'+message+"<\/span>";content+="<\/div>";$("#messages-list .row").append(content);$("#chat-modal-body").scrollTop($("#chat-modal-body")[0].scrollHeight);$("#chat-textarea").val("");$.ajax({type:"POST",url:"/Messaggi/Send",data:{IdChat:idChat,IdPersonToChat:idPerson,Message:message},dataType:"json",cache:!1,success:function(){},error:function(){TrapError("Error during SendMessage")}})}function ReportAd(){let idAnnuncio=document.getElementById("id-annuncio").value,idReason=$("#report-reason input[type=radio]:checked").val(),message=$("#report-test").val();idReason!=undefined?$.ajax({type:"POST",url:"/Annunci/ReportAd",data:{Id:idAnnuncio,ReportReasonId:idReason,ReportMessage:message},dataType:"json",cache:!1,success:function(){alert("L'annuncio Ã¨ stato segnalato.")},error:function(xhr,status,error){TrapError("error "+error)}}):alert("Devi selezionare un motivo prima di continuare")}$(document).ready(function(){$("#virtual-assistent").load("/VirtualAssistent/GetAvatar?IsForBuy=true",function(){});var idAnnuncio=document.getElementById("id-annuncio").value;LoadCalendar(idAnnuncio,!1);LoadReportModal();$(".btn-modal-prenota").click(function(){var now=new Date,idAnnuncio=document.getElementById("id-annuncio").value,today=new Date,dd=String(today.getDate()).padStart(2,"0"),mm=String(today.getMonth()+1).padStart(2,"0"),yyyy=today.getFullYear();GetAndShowAppuntamentiDisponibili(idAnnuncio,yyyy+"-"+mm+"-"+dd)})});