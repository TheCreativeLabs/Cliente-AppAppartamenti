function FacebookLogin(button){$(button).children(".spinner").removeClass("d-none");$.ajax({type:"POST",url:"/Login/GetFacebookExternalLogin",contentType:"application/json; charset=utf-8",success:function(result){window.location.href=result},error:function(){$(button).children(".spinner").addClass("d-none");TrapError("Error during FacebookLogin")}})}function GoogleLogin(button){$(button).children(".spinner").removeClass("d-none");$.ajax({type:"POST",url:"/Login/GetGoogleExternalLogin",contentType:"application/json; charset=utf-8",success:function(result){window.location.href=result},error:function(){$(button).children(".spinner").addClass("d-none");TrapError("Error during GoogleLogin")}})}function ButtonPlusIncrement(e,buttonPlus){try{e.preventDefault();fieldName=$(buttonPlus).attr("data-field");var currentVal=parseInt($("input[name="+fieldName+"]").val());isNaN(currentVal)?$("input[name="+fieldName+"]").val(0):$("input[name="+fieldName+"]").val(currentVal+1)}catch(ex){TrapError("Error during ButtonPlusIncrement"+ex)}}function ButtonPlusDecrement(e,buttonMinus){try{e.preventDefault();fieldName=$(buttonMinus).attr("data-field");var currentVal=parseInt($("input[name="+fieldName+"]").val());!isNaN(currentVal)&&currentVal>0?$("input[name="+fieldName+"]").val(currentVal-1):$("input[name="+fieldName+"]").val(0)}catch(ex){TrapError("Error during ButtonPlusIncrement"+ex)}}function LoadFilterModal(divFilterModal){try{var filterModalUrl=$(divFilterModal).data("url");$(divFilterModal).load(filterModalUrl)}catch(ex){TrapError("Error during ButtonPlusIncrement")}}function GetUserInfo(){$.ajax({type:"POST",url:"/Account/GetUserInfo",contentType:"application/json; charset=utf-8",success:function(result){var userInfo=JSON.parse(result);document.getElementById("profileImage").src=userInfo.FotoProfilo!=undefined?"data:image/png;base64,"+userInfo.FotoProfilo:userInfo.PhotoUrl;$("#lblNomeCognome").text(userInfo.Nome+" "+userInfo.Cognome);$("#lblEmail").text(userInfo.Email)},error:function(){TrapError("Error during GetUserInfo")}})}function NavigateToDetail(Url){window.location.href=Url}function Login(url){$("#spinner-login").removeClass("d-none");$("#btn-login").attr("disabled","disabled");$.ajax({type:"POST",url:url,data:{Email:$("#email").val(),Password:$("#password").val()},dataType:"json",cache:!1,success:function(){location.reload()},error:function(xhr,status,error){$("#spinner-login").addClass("d-none");$("#btn-login").removeAttr("disabled");$("#login-error").removeClass("d-none");Console.log("Error in Login function: "+error)}})}function AddPreferred(btn,url,id){event.stopPropagation();alert(id);alert(url);$.ajax({type:"POST",url:url,data:{Id:id},dataType:"json",success:function(){$(btn).addClass("text-primary")},error:function(){TrapError("Error during AddPreferred")}})}function RemovePreferred(btn,url,id){event.stopPropagation();$.ajax({type:"POST",url:url,data:{Id:id},dataType:"json",success:function(){$(btn).addClass("text-primary")},error:function(){TrapError("Error during ButtonPlusIncrement")}})}function EnableSearch(searchTextbox){try{let searchButton=$(".search-button"),nomeComune=$(searchTextbox).val();listaComuni.length>0&&nomeComune.length<3?(listaComuni=[],searchButton.addClass("disabled"),$(searchTextbox).autocomplete({source:[]})):listaComuni.length==0&&nomeComune.length>=3&&($(".search-spinner").show(),$.ajax({type:"POST",url:"/Home/ListaComuni",data:{NomeComune:nomeComune},dataType:"json",cache:!1,success:function(result){var nomiComuni,i;for(listaComuni=result,nomiComuni=[],i=0;i<result.length;i++)nomiComuni.push(result[i].NomeComune);$(searchTextbox).autocomplete({source:nomiComuni,select:function(event,ui){var value,i;for(searchButton.removeClass("disabled"),value=ui.item.value,i=0;i<listaComuni.length;i++)if(listaComuni[i].NomeComune==value){$("#codiceComune").val(listaComuni[i].CodiceComune);$(".search-textbox").val(listaComuni[i].NomeComune);SaveFilter();break}}});$(".search-spinner").hide();$(searchTextbox).autocomplete("search")},error:function(){TrapError("Error during EnableSearch")}}))}catch(ex){TrapError("Error during EnableSearch")}}function TrapError(message){console.log(message);$("#errorContainer").show()}function OpenUrl(url){var win=window.open(url,"_blank");win.focus()}var listaComuni=[];$(document).ready(function(){loggedUser!=null&&loggedUser.length>0&&(GetUserInfo(),LoadFilterModal($("#divFilterModal")),$("#searchbarInput").keyup(function(){EnableSearch(this)}));$("#btnFacebookLogin").click(function(){FacebookLogin(this)});$("#btnGoogleLogin").click(function(){GoogleLogin(this)});$("#btn-login").click(function(){$("#form-login").valid()?Login($(this).data("url")):$("#form-login").addClass("was-validated")});$(".dropdown-agenda").click(function(e){e.stopPropagation()})});